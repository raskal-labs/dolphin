---
# This file is included from playbooks/lxc-adguard.yml (second play)

- name: âœ… Display FINAL AdGuard Setup Card
  vars:
    # Dynamically find the host source paths from the pve_lxc variable
    # We look for the mount that targets the 'conf' and 'work' directories
    mount_conf: "{{ hostvars['link-cable']['pve_lxc']['mounts'] | selectattr('target', 'search', 'conf') | map(attribute='source') | first }}"
    mount_work: "{{ hostvars['link-cable']['pve_lxc']['mounts'] | selectattr('target', 'search', 'work') | map(attribute='source') | first }}"
  
  ansible.builtin.debug:
    msg: |
      
      {{ adguard_ascii_logo }} 
      {{ adguard_ascii_install_success }}
      
      AdGuard home
      
      âœ… INSTALLATION COMPLETE: AdGuard Home
      
      ======================================================================
      
      ğŸ“¡ CONNECTION INFO:
        - Host: {{ inventory_hostname }}
        - IP Address: {{ ansible_host | default('N/A') }}
        - Domain Name: {{ services['adguard'].domain }}
        - Web UI (IP): Â  Â http://{{ ansible_host }}:{{ adguard_web_port | default(3000) }}
        - Web UI (Domain): http://{{ services['adguard'].domain }}:{{ adguard_web_port | default(3000) }}
        - DNS Server:Â  Â  {{ ansible_host }}:{{ adguard_dns_port | default(53) }}
      
      ğŸ”‘ CREDENTIALS:
        - User:Â  Â  Â  Â  {{ adguard_api_user | default('raskal') }}
        - Password:Â  Â  adguard (Default, unless changed in vault)
      
      ğŸ’¾ STATEFUL DATA (ZFS PERSISTENCE):
        - Config Dir (Host): Â  Â  Â  {{ mount_conf }}
        - Config Dir (Container): /var/lib/adguardhome/conf
        - Working Dir (Host):Â  Â  Â  {{ mount_work }}/
        - Working Dir (Container): /var/lib/adguardhome/work/
      
      ğŸ›¡ï¸Â  INFRASTRUCTURE STATUS:
        - Container ID: {{ hostvars['link-cable']['pve_lxc']['vmid'] }} (Stateless App)
        - Action:Â  Â  Â  Â This container can be destroyed and recreated safely.
      
      ======================================================================

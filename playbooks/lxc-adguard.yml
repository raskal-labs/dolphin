# playbooks/lxc-adguard.yml
---
# 1. Provisioning Phase
- name: Provision AdGuard LXC (link-cable)
  hosts: gamecube
  become: true
  gather_facts: false

  tasks:
    - name: Delegate container creation to pve-lxc role
      ansible.builtin.include_role:
        name: pve-lxc
      vars:
        pve_lxc: "{{ hostvars['link-cable']['pve_lxc'] }}"

# 2. Configuration Phase
- name: Configure AdGuard Home Application
  hosts: link-cable
  become: true
  gather_facts: true

  # Load the logos here so they are available for the success card
  vars_files:
    - "../assets/logos.yml"

  pre_tasks:
    - name: Wait for SSH connection
      ansible.builtin.wait_for_connection:
        timeout: 60
        delay: 5

  roles:
    - lxc-adguard

  # --- INFRASTRUCTURE SUMMARY CARD ---
  post_tasks:
    - name: Include Final Summary Card
      ansible.builtin.include_tasks:
        file: roles/lxc-adguard/tasks/success.yml

---
# roles/dolphin/tasks/git-ssh.yml
# Bootstrap SSH + Git + ecco for root on gamecube

- name: Ensure /root/.ssh exists
  ansible.builtin.file:
    path: /root/.ssh
    state: directory
    owner: root
    group: root
    mode: "0700"

- name: Install GitHub SSH private key for root
  ansible.builtin.copy:
    src: id_ed25519
    dest: /root/.ssh/id_ed25519
    owner: root
    group: root
    mode: "0600"

- name: Install GitHub SSH public key for root
  ansible.builtin.copy:
    src: id_ed25519.pub
    dest: /root/.ssh/id_ed25519.pub
    owner: root
    group: root
    mode: "0644"

- name: Ensure known_hosts contains GitHub key
  ansible.builtin.known_hosts:
    path: /root/.ssh/known_hosts
    name: github.com
    key: "github.com ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIOMqq2zu1PZccNsxJ8mBhn4vG4y88WdF5vN1K3yRIFJ"

- name: Install ecco helper into /etc/profile.d
  ansible.builtin.copy:
    src: ecco.sh
    dest: /etc/profile.d/ecco.sh
    owner: root
    group: root
    mode: "0644"

- name: Set global git user.name
  ansible.builtin.git_config:
    name: user.name
    scope: global
    value: "raskal"

- name: Set global git user.email
  ansible.builtin.git_config:
    name: user.email
    scope: global
    value: "labs@raskal.io"

---
- name: Provision file-select LXC on gamecube
  hosts: gamecube
  gather_facts: false
  roles:
    - pve-lxc
    - ssh-base    # SSH hardening on gamecube (host)

- name: Bootstrap Debian inside file-select
  hosts: file-select
  gather_facts: false

  pre_tasks:
    - name: Wait for SSH to be ready on file-select
      wait_for_connection:
        timeout: 60
        delay: 5
        sleep: 3

    - name: Gather facts after SSH is up
      setup:

  roles:
    - base-debian
    - ssh-base      # key-only SSH inside CT
    - lxc-keycloak  # Keycloak install/config
